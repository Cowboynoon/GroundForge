<!DOCTYPE html>
<head lang="en">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title lang="en">DiBL - Bobbin lace working diagrams for grounds</title>
    <link href="colorpicker/mcColorPicker.css" rel="stylesheet" type="text/css" />
    <script src="colorpicker/mcColorPicker.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="show-graph.js"></script>
    <script src="sample.js"></script>
    <script src="matrix-graphs.js"></script>
    <script>
      function show(form) {
        var data = dibl.D3Data().get(
          form.set.value,
          form.nrInSet.value * 1,
          form.rows.value * 1,
          form.cols.value * 1,
          form.shiftLeft.value * 1,
          form.shiftUp.value * 1,
          form.stitches.value
          )
        document.getElementById('pairDiagram').innerHTML = ""
        document.getElementById('threadDiagram').innerHTML = ""
        showGraph({
          threadColor: '#colorpicker',
          container: '#pairDiagram',
          width: form.pairWidth.value * 1,
          height: form.pairHeight.value * 1,
          nodes: data.nodes,
          links: data.links,
        })
        showGraph({
          threadColor: '#colorpicker',
          container: '#threadDiagram',
          width: form.threadWidth.value * 1,
          height: form.threadHeight.value * 1,
          nodes: data.threadNodes,
          links: data.threadLinks,
        })
      }
      function setMax(form) {
        form.nrInSet.max = form.set[form.set.selectedIndex].getAttribute("data-max-nr")
      }
      function setLocation(e) {
        if (e.value == '')
          window.location.href='index.html'
        else
          window.location.href='?name='+e.options[e.selectedIndex].text+'&'+e.value
      }
      function init() {
        var location = (window.location.href + "").replace("#","")
        if (location.indexOf("?") >= 0) {
          location.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
              var fields = document.getElementsByName(key)
              if (fields.length > 0) {
                  fields[0].value = decodeURIComponent(value).replace(/[+]/g," ")
              }
          })
          show(document.getElementById('graph'))
        } else{
          document.getElementById('pairDiagram').innerHTML = ""
          showGraph({
            threadColor: '#colorpicker',
            container: '#pairDiagram',
            width: 500,
            height: 240,
            nodes: sample.nodes,
            links: sample.links,
        })}
      }
    </script>
   <style>
     input { width: 3em; }
     #colorpicker { width: 5em; }
     form, #pairDiagram, #threadDiagram { display: inline-block; }
     svg{ border: solid 1px #AAA; margin-right: 0.4em; display: inline-block; }
     fieldset { padding-right: 0.2em; padding-bottom: 0.2em}
     .link {fill: #fff; opacity: 1;}
     .node {fill: #000; opacity: 0;}
     .node.fixed {fill: #90f;}
     .hidden {display: none}
     .shown {display: inline}
   </style>
</head>
<body onload="init();setMax(document.getElementById('graph'))" lang="en">
  <div>
    <img style="float: right" src="logo-big.png" alt="DiBL logo"
         title="3 tiles each with a single stitch. Thick coloured lines for the pair diagram, thin black lines for a thread diagram"/>
    <h1>Bobbin lace working diagrams</h1>
    <ul><li>
      Drag a diagram around for the proper orientation.
    </li><li>
      FireFox, Chrome and Safari are fine, IE has a <a href="https://connect.microsoft.com/IE/feedback/details/801938/dynamically-updated-svg-path-with-a-marker-end-does-not-update"
      >problem</a> rendering the color codes of pair diagrams and over-under effect of thread diagrams.
    </li><li>
      Numbers of the NxM patterns are the same as for the <a href="http://jo-pol.github.io/DiBL/grounds/"
      >interleaved</a> patterns based on templates but different from the <a href="http://web.uvic.ca/%7Evmi/papers/interleavedpatterns.html"
      >original data</a>.
    </li></ul>
  </div>
    <form id="graph" onsubmit="return true">
      <fieldset style="border: none">
        <legend>Configure a pattern</legend>

          <select size="1" onChange="setLocation(this)">
              <option value=""
              >select another pattern</option>
              <option value=""
              >initial sample</option>
              <option value="nrInSet=0&set=2x4 small snowflakes&shiftLeft=0&shiftUp=0&rows=5&cols=7&pairWidth=275&pairHeight=250&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >small snow</option>
              <option value="nrInSet=22&set=2x4&shiftLeft=1&shiftUp=3&rows=10&cols=8&pairWidth=400&pairHeight=400&threadWidth=1200&threadHeight=999&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >small snow and hexagons</option>
              <option value="nrInSet=16&set=2x4&shiftLeft=1&shiftUp=0&rows=10&cols=8&pairWidth=400&pairHeight=400&threadWidth=1200&threadHeight=999&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >open snow</option>
              <option value="nrInSet=0&set=2x4 torchon&shiftLeft=1&rows=5&cols=5&shiftUp=1&pairWidth=275&pairHeight=275&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >torchon</option>
              <option value="nrInSet=4&set=2x2&shiftLeft=0&rows=5&cols=5&shiftUp=1&pairWidth=275&pairHeight=275&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >cloth</option>
              <option value="nrInSet=2&set=2x4 rose ground&shiftLeft=0&shiftUp=2&rows=10&cols=8&pairWidth=275&pairHeight=275&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >rose ground variation</option>
              <option value="nrInSet=0&set=2x4 vrouwkens&shiftLeft=0&rows=9&cols=9&shiftUp=0&pairWidth=400&pairHeight=400&threadWidth=999&threadHeight=999&stitches=C2=tctc, B1=tc, A1=tc, D1=tctc, A2=tc, B2=tc, C1=tctc"
                      lang="nl-BE">vrouwkens</option>
              <option value="nrInSet=0&set=2x4 bias&shiftLeft=1&rows=8&cols=5&shiftUp=0&pairWidth=275&pairHeight=275&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >bias</option>
              <option value="nrInSet=0&set=2x4 paris/kat&shiftLeft=1&rows=8&cols=7&shiftUp=1&pairWidth=275&pairHeight=275&threadWidth=900&threadHeight=900&stitches=A1=tctc, C1=tctc, C2=tctc, D2=tctc, A2=tctc, B2=tctc"
              >paris/kat</option>
              <option value="nrInSet=0&set=2x2&shiftLeft=0&shiftUp=2&rows=8&cols=5&pairWidth=275&pairHeight=275&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >kat variation</option>
              <option value="nrInSet=5&set=2x4&shiftLeft=0&shiftUp=0&rows=8&cols=5&pairWidth=350&pairHeight=350&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >mini fish</option>
              <option value="nrInSet=10&set=2x4&shiftLeft=0&shiftUp=0&rows=8&cols=5&pairWidth=350&pairHeight=350&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >mini fish and triangles</option>
              <option value="nrInSet=27&set=2x4&shiftLeft=0&shiftUp=2&rows=8&cols=5&pairWidth=350&pairHeight=350&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >diagonal snow</option>
              <option value="nrInSet=11&set=2x4&shiftLeft=0&shiftUp=0&rows=8&cols=5&pairWidth=350&pairHeight=350&threadWidth=800&threadHeight=800&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >mini fish and rectangles</option>
              <option value="nrInSet=22&set=2x4&shiftLeft=1&shiftUp=3&rows=10&cols=8&pairWidth=400&pairHeight=400&threadWidth=1200&threadHeight=999&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >tilted fish</option>
              <option value="nrInSet=6&set=2x4&shiftLeft=0&shiftUp=0&rows=7&cols=8&pairWidth=350&pairHeight=350&threadWidth=900&threadHeight=900&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >interlocked snow</option>
              <option value="nrInSet=9&set=2x4&shiftLeft=0&shiftUp=0&rows=10&cols=5&pairWidth=350&pairHeight=350&threadWidth=900&threadHeight=900&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >asym chained snow</option>
              <option value="nrInSet=29&set=2x4&shiftLeft=0&shiftUp=1&rows=10&cols=5&pairWidth=350&pairHeight=350&threadWidth=900&threadHeight=900&stitches=A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc"
              >whatever</option>
          </select>
          <img alt="(i)"
               title ="Fills the form with values that produce a pattern with complete footsides and hence a full thread diagram. The number of columns may need an increment/decrement of four"
               src="information-icon.png">
          &nbsp;
          <button class="button" onclick="show(this.form)"
          >draw</button>
          <img alt="(i)" title ="a variation of a previously selected pattern using the options below"
               src="information-icon.png">

        <fieldset>
            <legend>Patch size (stitches)</legend>
            <label for="rows">rows</label>
            <input id="rows" name="rows" min="0" max="20" value="6" type="number"/>
            <label for="cols">columns</label>
            <input id="cols" name="cols" min="0" max="20" value="5" type="number"/>
        </fieldset>

        <fieldset>
            <legend>Stitches <img alt="(i)"
                                  title ="c(ross) t(wist) l(eft-twist) r(ight-twist) p(in); compare with tooltips in the diagrams"
                                  src="information-icon.png"></legend>
          <textarea rows="3" cols="30" id="stitches" name="stitches"
          >A1=tc, B1=tctc, C1=tc, D1=tctc, A2=tc, B2=tc, C2=tc, D2=tc</textarea>
        </fieldset>
      </fieldset>

        <fieldset style="border: none">
        <legend>Advanced options
            <img alt="(i)"
                 title ="Most footsides of pair diagrams are inclomplete, that causes incomplete (and sometimes tubular) thread diagrams. Some of these may render a triangular patch as thread diagram when specifying enough columns."
                 src="information-icon.png">
            <span class="show"><a href="#" onclick="document.getElementById('advanced').classList.remove('hidden');this.classList.add('hidden')=''">show</a></span>
        </legend>

        <div class="hidden" id="advanced">
        <fieldset>
            <label for="nrInSet">nr</label>
            <input id="nrInSet" name="nrInSet" min="0" max="2" value="0" type="number"/>
            <label for="set">in set</label>
            <select size="1" id="set" name="set" onChange="setMax(form)">
                <option data-max-nr="4" value="2x4 torchon">torchon</option>
                <option data-max-nr="2" value="2x4 bias">bias</option>
                <option data-max-nr="0" value="2x4 paris/kat">paris/kat</option>
                <option data-max-nr="1" value="2x4 cloth">cloth</option>
                <option data-max-nr="0" value="2x4 vrouwkens">vrouwkens</option>
                <option data-max-nr="1" value="2x4 small snowflakes">small snowflakes</option>
                <option data-max-nr="4" value="2x4 rose ground" selected>rose ground</option>
                <option data-max-nr="6">2x2</option>
                <option data-max-nr="92">4x2</option>
                <option data-max-nr="46">2x4</option>
            </select>
        </fieldset>

        <fieldset>
            <legend>Shift (stitches)</legend>
            <label for="shiftLeft">footside by </label>
            <input id="shiftLeft" name="shiftLeft" min="0" max="3" value="0" type="number"/>
            <label for="shiftUp">top by </label>
            <input id="shiftUp" name="shiftUp" min="0" max="3" value="0" type="number"/>
        </fieldset>

        <fieldset>
            <legend>Image sizes (pixels)</legend>

            <fieldset>
                <legend>Pair diagram</legend>
                <label for="pairWidth">width</label>
                <input id="pairWidth" name="pairWidth" min="200" max="999" value="275" type="number"/>
                <label for="pairHeight">height</label>
                <input id="pairHeight" name="pairHeight" min="200" max="999" value="437" type="number"/>
            </fieldset>

            <fieldset>
                <legend>Thread diagram</legend>
                <label for="threadWidth">width</label>
                <input id="threadWidth" name="threadWidth" min="200" max="2000" value="350" type="number"/>
                <label for="threadHeight">height</label>
                <input id="threadHeight" name="threadHeight" min="200" max="1024" value="437" type="number"/>
            </fieldset>
        </fieldset>
        </div>
      </fieldset>


      <fieldset style="border: none">
        <label for="colorpicker">
            Paint threads
            <img alt="(i)" title ="Single click the square start of a thread to paint it" src="information-icon.png">
        </label>
        <input id="colorpicker" type="text" class="color" value="#CC0000"/>
      </fieldset>
    </form>
    <div id="pairDiagram"><p>
        Generating diagram... You might have to clear your cache to get the last update active.
    </p></div>
    <div id="threadDiagram"></div>
    <p><a href="https://github.com/jo-pol/dibl-tensioned/tree/gh-pages/#how-its-made"
       >How it's made</a> &mdash; <a href="https://github.com/jo-pol/dibl-tensioned/commits/gh-pages/"
       >Changes</a> &mdash; <a href="https://github.com/jo-pol/dibl-tensioned/issues"
       >Issues</a> &mdash; Based on scientific papers: <a href="http://web.uvic.ca/%7Evmi/papers/bridges2012.html"
       >1</a>, <a href="http://web.uvic.ca/%7Evmi/papers/jmm2014.html"
       >2</a>. &mdash; Powered by: <a href="https://d3js.org"
       >D3.js</a>, <a href="http://www.menucool.com/color-picker"
       >Menucool</a>.
    </p>
</body>
